<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Villas — Infinity 8 Lombok</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Iconos / fuentes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <!-- CSS global del sitio -->
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/footer.css" />

  <!-- CSS específico -->
  <link rel="stylesheet" href="/css/villas.css" />
  <link rel="stylesheet" href="/css/galeria-infinity.css" />

  <!-- Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- i18next -->
  <script src="https://unpkg.com/i18next@23/i18next.min.js"></script>
  <script src="https://unpkg.com/i18next-http-backend@2/i18nextHttpBackend.min.js"></script>
  <script src="https://unpkg.com/i18next-browser-languagedetector@8/i18nextBrowserLanguageDetector.min.js"></script>
  <script src="/js/i18n.js" defer></script>

  <!-- Anime.js -->
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" defer></script>
</head>

<body class="villas-page">
  <!-- Header dinámico -->
  <div id="header-placeholder"></div>

  <main id="main-content" role="main">
    <!-- ===== Hero de Villas (imagen + datos) ===== -->
    <section class="vhv-hero" aria-label="Villas Infinity 8">
      <!-- Flecha volver -->
      <a href="/index.html" class="vhv-back" aria-label="Volver al inicio">
        <span class="vhv-back__icon" aria-hidden="true"><i class="fa-solid fa-arrow-left"></i></span>
        <span class="vhv-back__label" data-i18n="villas.back">Volver</span>
      </a>

      <div class="vhv-hero__container">
        <div class="vhv-hero__grid">
          <!-- Columna izquierda: imagen -->
          <figure class="vhv-media">
            <img
              src="/images/galeria-infinity/noche-izq.jpg"
              alt="Vista principal de la villa"
              class="vhv-img"
              loading="eager"
            />
          </figure>

          <!-- Columna derecha: información técnica plana -->
          <div class="vhv-info">
            <h1 class="vhv-title" data-i18n="villas.title">Villa Infinity 8</h1>

            <div class="vhv-tech" id="vhvSpec">
              <!-- Grupo: Área total -->
              <h2 class="vhv-tech__groupTitle" data-i18n="villas.tech.totalArea">Total Area</h2>
              <ul class="vhv-tech__list">
                <li><span class="vhv-tech__label" data-i18n="villas.tech.landPlot">Land Plot</span><span class="vhv-tech__value">121.45 m²</span></li>
                <li><span class="vhv-tech__label" data-i18n="villas.tech.landscape">Landscape</span><span class="vhv-tech__value">23.31 m²</span></li>
                <li><span class="vhv-tech__label" data-i18n="villas.tech.floor1Area">1st Floor</span><span class="vhv-tech__value">60.41 m²</span></li>
                <li><span class="vhv-tech__label" data-i18n="villas.tech.floor2Area">2nd Floor</span><span class="vhv-tech__value">85.76 m²</span></li>
              </ul>

              <!-- Grupo: 1ª planta -->
              <h2 class="vhv-tech__groupTitle" data-i18n="villas.tech.floor1">1st Floor</h2>
              <ul class="vhv-tech__list">
                <li><span class="vhv-tech__label" data-i18n="villas.tech.receptionist">Receptionist</span><span class="vhv-tech__value">12.82 m²</span></li>
                <li><span class="vhv-tech__label" data-i18n="villas.tech.powerHouse">Power House</span><span class="vhv-tech__value">8.75 m²</span></li>
                <li><span class="vhv-tech__label" data-i18n="villas.tech.staffRoom">Staff Room</span><span class="vhv-tech__value">10 m²</span></li>
                <li><span class="vhv-tech__label" data-i18n="villas.tech.storage">Storage</span><span class="vhv-tech__value">10 m²</span></li>
              </ul>

              <!-- Grupo: 2ª planta -->
              <h2 class="vhv-tech__groupTitle" data-i18n="villas.tech.floor2">2nd Floor</h2>
              <ul class="vhv-tech__list">
                <li><span class="vhv-tech__label" data-i18n="villas.tech.indoorArea">Indoor Area</span><span class="vhv-tech__value">39.72 m²</span></li>
                <li><span class="vhv-tech__label" data-i18n="villas.tech.outdoor">Outdoor</span><span class="vhv-tech__value">28.67 m²</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Separación inferior para la siguiente sección -->
      <div class="vhv-section-sep" aria-hidden="true"></div>
    </section>

    <!-- ===== Nueva sección: Galería Infinity (partial) ===== -->
    <section id="villas-gallery" class="vhv-gallery-section" aria-label="Galería Infinity">
      <div >
        <div id="galeriaInfinityHost" data-partial="/partials/galeria-infinity.html"></div>
      </div>
    </section>
  </main>

  <!-- Footer dinámico -->
  <div id="footer-placeholder"></div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ==== i18n helpers ==== -->
  <script>
    function __applyI18nFallback(scope=document){
      if (!window.i18next) return;
      scope.querySelectorAll('[data-i18n]').forEach(el=>{
        const k = el.getAttribute('data-i18n'); if (!k) return;
        el.textContent = i18next.t(k);
      });
      scope.querySelectorAll('[data-i18n-attr]').forEach(el=>{
        const spec = el.getAttribute('data-i18n-attr'); if (!spec) return;
        const opts = el.getAttribute('data-i18n-opts');
        const [attr,key] = spec.split('|');
        if (attr && key) el.setAttribute(attr, i18next.t(key, opts ? JSON.parse(opts) : undefined));
      });
      document.documentElement.setAttribute('lang', i18next.language || 'es');
    }
    function renderI18n(scope=document){
      if (window.applyI18nAndRoutes) { window.applyI18nAndRoutes(scope); }
      else { __applyI18nFallback(scope); }
    }
  </script>

  <!-- Carga header/footer + partial de galería + sincronización de i18n -->
  <script>
    const headerHost = document.getElementById('header-placeholder');
    const footerHost = document.getElementById('footer-placeholder');
    const galHost    = document.getElementById('galeriaInfinityHost');

    // bind global i18n events
    (function(){
      if (!window.i18next) return;
      const rerender = () => renderI18n(document);
      if (i18next.isInitialized) rerender();
      i18next.on('initialized', rerender);
      i18next.on('loaded', rerender);
      i18next.on('languageChanged', rerender);
    })();

    // Header
    fetch('/partials/header.html')
      .then(r => r.text())
      .then(html => {
        headerHost.innerHTML = html;
        document.querySelectorAll('header a[href]').forEach(a => {
          const href = a.getAttribute('href') || '';
          if (href.endsWith('villas.html') || href === '/villas.html') {
            a.classList.add('active');
            a.setAttribute('aria-current','page');
          }
        });
        renderI18n(headerHost);
      });

    // Footer
    fetch('/partials/footer.html')
      .then(r => r.text())
      .then(html => {
        footerHost.innerHTML = html;
        renderI18n(footerHost);
      });

    // Partial: galería infinity (simple)
    (function loadGallery(){
      const url = galHost?.dataset?.partial || '/partials/galeria-infinity.html';
      if (!galHost) return;
      fetch(url, { cache: 'no-store' })
        .then(r => r.text())
        .then(html => {
          galHost.innerHTML = html;
          renderI18n(galHost);  // por si el parcial trae etiquetas i18n
        })
        .catch(err => {
          galHost.innerHTML = '<div style="padding:1rem;background:#fee;border:1px solid #f99">No se pudo cargar la galería.</div>';
          console.error('Galería Infinity:', err);
        });
    })();
  </script>

  <!-- Animación: más lenta -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const root = document.getElementById('vhvSpec');
      if (!root) return;

      function splitChars(el){
        const t = el.textContent;
        el.textContent = '';
        const out = [];
        for (const ch of t){
          const s = document.createElement('span');
          s.className = 'vhv-char';
          s.textContent = ch;
          el.appendChild(s);
          out.push(s);
        }
        return out;
      }

      const rows = Array.from(root.querySelectorAll('.vhv-tech__list > li'));
      rows.forEach((li, i) => {
        const label = li.querySelector('.vhv-tech__label');
        const value = li.querySelector('.vhv-tech__value');
        const chars = [...splitChars(label), ...splitChars(value)];

        li.style.opacity = 0;

        const tl = anime.timeline({ autoplay: true });
        tl.add({
          targets: li,
          opacity: [0,1],
          easing: 'easeOutQuad',
          duration: 540,
          delay: i * 520
        })
        .add({
          targets: chars,
          opacity: [0,1],
          translateY: ['0.55em','0em'],
          easing: 'easeOutQuad',
          duration: 28,
          delay: anime.stagger(28),
          offset: '-=280'
        });
      });
    });
  </script>
  <script type="module">
    import { initGaleriaInfinity } from '/js/galeria-infinity.js';

    async function loadGalleryPartial() {
        const host = document.getElementById('galeriaInfinityHost');
        if (!host) return;

        // 1) Cargar el parcial (sin ejecutar scripts embebidos)
        const res = await fetch(host.dataset.partial || '/partials/galeria-infinity.html', { cache: 'no-store' });
        if (!res.ok) {
        host.innerHTML = `<div style="padding:1rem;background:#fee;border:1px solid #f99">No se pudo cargar la galería (${res.status}).</div>`;
        return;
        }
        host.innerHTML = (await res.text()).trim();

        // 2) Re-aplicar i18n solo al bloque insertado
        if (window.applyI18nAndRoutes) window.applyI18nAndRoutes(host);
        else if (window.renderI18n) window.renderI18n(host);

        // 3) Inicializar la galería (igual que en index)
        initGaleriaInfinity(document);
    }

    loadGalleryPartial();
    </script>
</body>
</html>
